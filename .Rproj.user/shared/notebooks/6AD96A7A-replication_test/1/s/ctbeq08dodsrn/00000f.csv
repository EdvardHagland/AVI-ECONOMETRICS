"0","# --- INTENT: Estimate DiD models with interaction terms for HTE using mig_long. ---"
"0","# --- EFFECT: Runs lm() models including triple interactions (treat*post*moderator). ---"
"0","message(""Running Robustness Check 4: Heterogeneity of Treatment Effects (Interactions)..."")"
"0",""
"0","# Ensure mig_long exists"
"0","if (!exists(""mig_long"")) {"
"0","  stop(""Error in robust-hte-models: mig_long data frame not found."")"
"0","}"
"0",""
"0","# We use the Wave 2 dataset where effects were significant"
"0","data_w2_hte <- subset(mig_long, wave != 3 & nonmissing2) # Use mig_long"
"0",""
"0","# Base formula part"
"0","base_hte_formula <- ""mg.asp ~ treat.dum * post.dum * MODERATOR + factor(Region)"""
"0",""
"0","# Function to create and run HTE model"
"0","run_hte_model <- function(moderator_var, data) {"
"0","  if (!moderator_var %in% names(data)) {"
"0","    message(""Moderator variable '"", moderator_var, ""' not found. Skipping HTE for this variable."")"
"0","    return(NULL)"
"0","  }"
"0","  # Check for sufficient variation in moderator"
"0","  if (length(unique(na.omit(data[[moderator_var]]))) < 2) {"
"0","      message(""Moderator variable '"", moderator_var, ""' has insufficient variation. Skipping HTE."")"
"0","      return(NULL)"
"0","  }"
"0",""
"0","  formula_str <- gsub(""MODERATOR"", moderator_var, base_hte_formula)"
"0","  model <- tryCatch({"
"0","      lm(as.formula(formula_str), data = data, weights = wt2)"
"0","    }, error = function(e) {"
"0","      message(""Error fitting HTE model for "", moderator_var, "": "", e$message); return(NULL)"
"0","  })"
"0","  if (!is.null(model)) print(summary(model)) # DEBUG PRINT"
"0","  return(model)"
"0","}"
"0",""
"0","# Estimate models for each moderator (using variables confirmed in mig_long)"
"0","hte_male <- run_hte_model(""male"", data_w2_hte)"
"1","
Call:
"
"1",""
"1","lm(formula = as.formula(formula_str), data = data, weights = wt2)"
"1",""
"1","

"
"1","Weighted "
"1",""
"1","Residuals:
"
"1","    Min "
"1","     1Q "
"1"," Median "
"1","     3Q "
"1","    Max "
"1","
"
"1","-2.9644 "
"1","-0.7376 "
"1"," 0.3305 "
"1"," 0.5866 "
"1"," 2.2153 "
"1","
"
"1","
Coefficients:
"
"1","                                "
"1","  Estimate"
"1"," Std. Error"
"1"," t value"
"1"," Pr(>|t|)"
"1","    "
"1","
(Intercept)                     "
"1","  3.722305"
"1","   0.095861"
"1","  38.830"
"1","  < 2e-16"
"1"," ***"
"1","
treat.dum                       "
"1"," -0.015095"
"1","   0.131086"
"1","  -0.115"
"1","  0.90834"
"1","    "
"1","
post.dum                        "
"1"," -0.021024"
"1","   0.130530"
"1","  -0.161"
"1","  0.87207"
"1","    "
"1","
male                            "
"1"," -0.132685"
"1","   0.117543"
"1","  -1.129"
"1","  0.25917"
"1","    "
"1","
factor(Region)Lower River Region"
"1"," -0.119030"
"1","   0.121552"
"1","  -0.979"
"1","  0.32763"
"1","    "
"1","
factor(Region)Upper River Region"
"1"," -0.272587"
"1","   0.087747"
"1","  -3.107"
"1","  0.00193"
"1"," ** "
"1","
factor(Region)West Coast Region "
"1"," -0.050830"
"1","   0.070796"
"1","  -0.718"
"1","  0.47289"
"1","    "
"1","
treat.dum:post.dum              "
"1"," -0.176959"
"1","   0.184878"
"1","  -0.957"
"1","  0.33865"
"1","    "
"1","
treat.dum:male                  "
"1"," -0.004515"
"1","   0.167823"
"1","  -0.027"
"1","  0.97854"
"1","    "
"1","
post.dum:male                   "
"1","  0.015504"
"1","   0.165270"
"1","   0.094"
"1","  0.92527"
"1","    "
"1","
treat.dum:post.dum:male         "
"1"," -0.204272"
"1","   0.236625"
"1","  -0.863"
"1","  0.38814"
"1","    "
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
Residual standard error:"
"1"," "
"1","1.116"
"1"," "
"1","on"
"1"," "
"1","1354"
"1"," "
"1","degrees of freedom"
"1","
"
"1","  ("
"1",""
"1","49 observations deleted due to missingness"
"1",""
"1",")
"
"1","Multiple R-squared: "
"1"," "
"1","0.03128"
"1",",	Adjusted R-squared: "
"1"," "
"1","0.02413"
"1"," "
"1","
F-statistic:"
"1"," "
"1","4.372"
"1"," "
"1","on"
"1"," "
"1","10"
"1"," "
"1","and"
"1"," "
"1","1354"
"1"," "
"1","DF,  p-value:"
"1"," "
"1","4.657e-06"
"1","
"
"1","
"
"0","hte_educ <- run_hte_model(""educ"", data_w2_hte) # Treat educ as numeric/ordinal"
"1","
Call:
"
"1",""
"1","lm(formula = as.formula(formula_str), data = data, weights = wt2)"
"1",""
"1","

"
"1","Weighted "
"1",""
"1","Residuals:
"
"1","    Min "
"1","     1Q "
"1"," Median "
"1","     3Q "
"1","    Max "
"1","
"
"1","-3.0585 "
"1","-0.6754 "
"1"," 0.3829 "
"1"," 0.6928 "
"1"," 2.0688 "
"1","
"
"1","
Coefficients:
"
"1","                                "
"1"," Estimate"
"1"," Std. Error"
"1"," t value"
"1"," Pr(>|t|)"
"1","    "
"1","
(Intercept)                     "
"1","  3.46091"
"1","    0.28158"
"1","  12.291"
"1","  < 2e-16"
"1"," ***"
"1","
treat.dum                       "
"1","  0.25030"
"1","    0.41636"
"1","   0.601"
"1","  0.54782"
"1","    "
"1","
post.dum                        "
"1"," -0.24450"
"1","    0.39358"
"1","  -0.621"
"1","  0.53456"
"1","    "
"1","
educ                            "
"1","  0.08266"
"1","    0.12561"
"1","   0.658"
"1","  0.51060"
"1","    "
"1","
factor(Region)Lower River Region"
"1"," -0.14275"
"1","    0.12206"
"1","  -1.170"
"1","  0.24238"
"1","    "
"1","
factor(Region)Upper River Region"
"1"," -0.25926"
"1","    0.08885"
"1","  -2.918"
"1","  0.00358"
"1"," ** "
"1","
factor(Region)West Coast Region "
"1"," -0.05795"
"1","    0.07096"
"1","  -0.817"
"1","  0.41429"
"1","    "
"1","
treat.dum:post.dum              "
"1"," -0.22636"
"1","    0.58711"
"1","  -0.386"
"1","  0.69989"
"1","    "
"1","
treat.dum:educ                  "
"1"," -0.12092"
"1","    0.18601"
"1","  -0.650"
"1","  0.51574"
"1","    "
"1","
post.dum:educ                   "
"1","  0.10756"
"1","    0.17716"
"1","   0.607"
"1","  0.54386"
"1","    "
"1","
treat.dum:post.dum:educ         "
"1"," -0.03545"
"1","    0.26230"
"1","  -0.135"
"1","  0.89252"
"1","    "
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
Residual standard error:"
"1"," "
"1","1.119"
"1"," "
"1","on"
"1"," "
"1","1354"
"1"," "
"1","degrees of freedom"
"1","
"
"1","  ("
"1",""
"1","49 observations deleted due to missingness"
"1",""
"1",")
"
"1","Multiple R-squared: "
"1"," "
"1","0.02552"
"1",",	Adjusted R-squared: "
"1"," "
"1","0.01832"
"1"," "
"1","
F-statistic:"
"1"," "
"1","3.546"
"1"," "
"1","on"
"1"," "
"1","10"
"1"," "
"1","and"
"1"," "
"1","1354"
"1"," "
"1","DF,  p-value:"
"1"," "
"1","0.0001199"
"1","
"
"1","
"
"0","hte_bs_exp <- run_hte_model(""bs.exp.now"", data_w2_hte)"
"1","
Call:
"
"1",""
"1","lm(formula = as.formula(formula_str), data = data, weights = wt2)"
"1",""
"1","

"
"1","Weighted "
"1",""
"1","Residuals:
"
"1","    Min "
"1","     1Q "
"1"," Median "
"1","     3Q "
"1","    Max "
"1","
"
"1","-2.8505 "
"1","-0.7950 "
"1"," 0.2708 "
"1"," 0.7111 "
"1"," 2.0443 "
"1","
"
"1","
Coefficients:
"
"1","                                "
"1"," Estimate"
"1"," Std. Error"
"1"," t value"
"1"," Pr(>|t|)"
"1","    "
"1","
(Intercept)                     "
"1","  3.75231"
"1","    0.08296"
"1","  45.230"
"1","  < 2e-16"
"1"," ***"
"1","
treat.dum                       "
"1"," -0.05209"
"1","    0.11854"
"1","  -0.439"
"1","  0.66045"
"1","    "
"1","
post.dum                        "
"1","  0.07367"
"1","    0.11160"
"1","   0.660"
"1","  0.50929"
"1","    "
"1","
bs.exp.now                      "
"1"," -0.22284"
"1","    0.11368"
"1","  -1.960"
"1","  0.05016"
"1"," .  "
"1","
factor(Region)Lower River Region"
"1"," -0.15817"
"1","    0.12078"
"1","  -1.310"
"1","  0.19054"
"1","    "
"1","
factor(Region)Upper River Region"
"1"," -0.24385"
"1","    0.08785"
"1","  -2.776"
"1","  0.00558"
"1"," ** "
"1","
factor(Region)West Coast Region "
"1"," -0.07554"
"1","    0.07066"
"1","  -1.069"
"1","  0.28521"
"1","    "
"1","
treat.dum:post.dum              "
"1"," -0.45254"
"1","    0.16741"
"1","  -2.703"
"1","  0.00695"
"1"," ** "
"1","
treat.dum:bs.exp.now            "
"1","  0.09643"
"1","    0.16386"
"1","   0.589"
"1","  0.55628"
"1","    "
"1","
post.dum:bs.exp.now             "
"1"," -0.17217"
"1","    0.15981"
"1","  -1.077"
"1","  0.28151"
"1","    "
"1","
treat.dum:post.dum:bs.exp.now   "
"1","  0.29301"
"1","    0.23105"
"1","   1.268"
"1","  0.20494"
"1","    "
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
Residual standard error:"
"1"," "
"1","1.113"
"1"," "
"1","on"
"1"," "
"1","1354"
"1"," "
"1","degrees of freedom"
"1","
"
"1","  ("
"1",""
"1","49 observations deleted due to missingness"
"1",""
"1",")
"
"1","Multiple R-squared: "
"1"," "
"1","0.03566"
"1",",	Adjusted R-squared: "
"1"," "
"1","0.02854"
"1"," "
"1","
F-statistic:"
"1"," "
"1","5.008"
"1"," "
"1","on"
"1"," "
"1","10"
"1"," "
"1","and"
"1"," "
"1","1354"
"1"," "
"1","DF,  p-value:"
"1"," "
"1","3.563e-07"
"1","
"
"1","
"
"0","message(""HTE interaction models estimated (if data allowed)."")"
