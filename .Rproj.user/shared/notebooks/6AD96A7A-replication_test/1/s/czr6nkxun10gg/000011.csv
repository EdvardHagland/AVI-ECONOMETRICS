"0","# --- INTENT: Replicate Table 2a from the paper (Wave 2 Models) with Hochberg correction. ---"
"0","# --- EFFECT: This chunk prepares inputs and generates Table 2a using modelsummary. ---"
"0",""
"0","# Load modelsummary (likely loaded in setup)"
"0","# library(modelsummary)"
"0","# library(tibble)"
"0",""
"0","# --- Apply Hochberg step-down correction ---"
"0","# Create a function to apply Hochberg correction to a model's p-values"
"0","hochberg_correction <- function(model) {"
"0","  # Extract coefficient table"
"0","  coef_table <- summary(model)$coefficients"
"0","  "
"0","  # Create a copy of the model"
"0","  adjusted_model <- model"
"0","  "
"0","  # Apply Hochberg correction to all p-values"
"0","  p_values <- coef_table[, ""Pr(>|t|)""]"
"0","  adjusted_p <- p.adjust(p_values, method = ""hochberg"")"
"0","  "
"0","  # Replace standard errors with adjusted p-values for display purposes"
"0","  # This is a hack since modelsummary doesn't easily allow showing p-values directly"
"0","  corrected_table <- coef_table"
"0","  corrected_table[, ""Std. Error""] <- adjusted_p"
"0","  "
"0","  # Store the adjusted coefficient table in the model"
"0","  attr(adjusted_model, ""hochberg_coef"") <- corrected_table"
"0","  "
"0","  # Return the modified model"
"0","  return(adjusted_model)"
"0","}"
"0",""
"0","# Custom tidy method for models with Hochberg correction"
"0","tidy.hochberg <- function(model, ...) {"
"0","  corrected_table <- attr(model, ""hochberg_coef"")"
"0","  result <- data.frame("
"0","    term = rownames(corrected_table),"
"0","    estimate = corrected_table[, ""Estimate""],"
"0","    std.error = corrected_table[, ""Std. Error""],  # These are actually the adjusted p-values"
"0","    statistic = corrected_table[, ""t value""],"
"0","    p.value = corrected_table[, ""Std. Error""]  # Use adjusted p-values for significance stars"
"0","  )"
"0","  return(result)"
"0","}"
"0",""
"0","# Apply Hochberg correction to the weighted DiD model"
"0","asp.did.w2_hochberg <- hochberg_correction(asp.did.w2)"
"0","class(asp.did.w2_hochberg) <- c(""hochberg"", class(asp.did.w2))"
"0",""
"0","# --- Prepare inputs for Table 2a --- "
"0","models_t2a <- list("
"0","  `W2 Mean` = asp.w2,"
"0","  `W2 DiD Wgt` = asp.did.w2,"
"0","  `W2 DiD Hochberg` = asp.did.w2_hochberg,"
"0","  `W2 DiD Unw` = asp.did.w2_unw"
"0",")"
"0",""
"0","stars_map <- c(""â€ "" = 0.1, ""*"" = 0.05, ""**"" = 0.01, ""***"" = 0.001)"
"0",""
"0","add_rows_t2a <- tibble::tribble("
"0","  ~term,           ~`W2 Mean`, ~`W2 DiD Wgt`, ~`W2 DiD Hochberg`, ~`W2 DiD Unw`,"
"0","  ""Fixed effects"", ""Yes"", ""Yes"", ""Yes"", ""Yes"","
"0","  ""IPW Weighted"",  ""Yes"", ""Yes"", ""Yes"", ""No"","
"0","  ""Multiple testing correction"", ""No"", ""No"", ""Yes"", ""No"""
"0",")"
"0",""
"0","# Custom function for modelsummary to handle our hochberg models"
"0","glance.hochberg <- function(x, ...) {"
"0","  # Extract the original model's glance information"
"0","  original_glance <- glance(x$model)"
"0","  # Return the same glance information"
"0","  return(original_glance)"
"0","}"
"0",""
"0","# --- Generate Table 2a --- "
"0","modelsummary(models_t2a,"
"0","             output = ""kableExtra"", "
"0","             fmt = 3, "
"0","             stars = stars_map, "
"0","             coef_omit = ""Region"", "
"0","             coef_rename = c(""treat.dum"" = ""Treat assignment"", "
"0","                           ""post.dum"" = ""Post-treatment"", "
"0","                           ""treat.dum:post.dum"" = ""Treat x Post"","
"0","                           ""(Intercept)"" = ""Constant""), "
"0","             gof_map = list("
"0","               list(""raw"" = ""nobs"", ""clean"" = ""Observations"", ""fmt"" = 0),"
"0","               list(""raw"" = ""r.squared"", ""clean"" = ""R$^{2}$"", ""fmt"" = 3),"
"0","               list(""raw"" = ""adj.r.squared"", ""clean"" = ""Adj. R$^{2}$"", ""fmt"" = 3)"
"0","             ),"
"0","             add_rows = add_rows_t2a,"
"0","             notes = list(""Standard errors in parentheses, except for Hochberg column which shows adjusted p-values."","
"0","                        ""Model (1) weighted. Model (2a) weighted DiD (original script). Model (2b) with Hochberg step-down correction. Model (2c) unweighted DiD."","
"0","                        ""All models include regional fixed effects.""),"
"0","             title = ""Effect of Program on Migration Aspiration (Wave 2 Models)"","
"0","             escape = FALSE"
"0","             ) %>%"
"0","  kable_styling(latex_options = c(""striped"", ""hold_position""), "
"0","                bootstrap_options = ""striped"","
"0","                position = ""center"","
"0","                font_size = 10,"
"0","                full_width = FALSE)"
