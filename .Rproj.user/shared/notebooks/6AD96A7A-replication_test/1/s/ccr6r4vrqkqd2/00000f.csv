"0","# --- INTENT: Replicate Table 2 from the paper, presenting OLS regression results for the effect of the treatment on migration aspiration (`mg.asp`). ---"
"0","# --- EFFECT: This chunk prepares the long-format data (`mig_long`), estimates several OLS models (Difference-in-Means and Difference-in-Differences, weighted and unweighted), and generates two formatted LaTeX tables (Table 2a for Wave 2, Table 2b for Wave 3) using `modelsummary`. ---"
"0",""
"0","# --- INTENT: Ensure necessary packages are loaded. ---"
"0","# --- EFFECT: Loads `stargazer` (used in original script, though `modelsummary` is used for final output here) and `dplyr` (used for data manipulation). ---"
"0","# Load stargazer if not already loaded in setup (Moved to setup chunk)"
"0","# library(stargazer)"
"0","# library(dplyr)"
"0",""
"0","# --- INTENT: Prepare the long-format data frame (`mig_long`) for Difference-in-Differences (DiD) analysis. ---"
"0","# --- EFFECT: Uses `mutate` to add a new column `post.dum` to `mig_long`. This column is assigned 1 if the `wave` column is greater than 1 (i.e., Wave 2 or 3), and 0 if `wave` is 1 (baseline). This variable is needed for the DiD interaction term. Overwrites the existing `mig_long`. ---"
"0","# --- Prepare Data --- "
"0","# Ensure mig_long is loaded from setup chunk (contains data across waves)"
"0",""
"0","# Add post.dum variable needed for DiD models"
"0","# Note: Original script uses subsetting flags (nonmissing2/3) not present in provided mig_long.csv."
"0","# We use !is.na(wt2/wt3) as the closest proxy based on context."
"0","mig_long <- mig_long %>% "
"0","  mutate("
"0","    # Create post.dum: 1 if wave is 2 or 3, 0 if wave is 1 (baseline)"
"0","    post.dum = ifelse(wave > 1, 1, 0)"
"0","  )"
"0",""
"0","# --- INTENT: Estimate the six OLS regression models presented in Table 2 of the paper (or variations thereof). ---"
"0","# --- EFFECT: Defines and runs six separate `lm` models, storing each result in a distinct variable (`asp.w2`, `asp.did.w2`, etc.). Each model regresses migration aspiration (`mg.asp`) on different combinations of treatment (`treat.dum`), post-treatment dummy (`post.dum`), their interaction, and regional fixed effects (`factor(Region)`). Models differ in the data subset used (Wave 2 only, Wave 3 only, Baseline+Wave2, Baseline+Wave3) and whether they apply inverse probability weights (`weights=wt2` or `weights=wt3`). Subsetting uses `!is.na(wtX)` as a proxy for original script's nonmissing flags. ---"
"0","# --- Estimate Models (replicating Table 2.R structure) --- "
"0",""
"0","# Model 1: Difference-in-Means (Wave 2 only)"
"0","# Regresses mg.asp ~ treatment + Region FE, weighted by wt2."
"0","# Uses only Wave 2 data where wt2 is not missing (proxy for nonmissing2)."
"0","asp.w2 <- lm(mg.asp ~ treat.dum + factor(Region), # factor() inside formula"
"0","             data=subset(mig_long, wave==2 & !is.na(wt2)), # use mig.long directly "
"0","             weights=wt2)"
"0",""
"0","# Model 2: Difference-in-Differences (Baseline vs Wave 2, Weighted)"
"0","# Regresses mg.asp ~ treat.dum * post.dum + Region FE, weighted by wt2."
"0","# Uses data from Wave 1 & 2 where wt2 is not missing (proxy for nonmissing2)."
"0","# Note: Weights argument commented out to match specific interpretation/debug step, maybe re-add later if needed per paper."
"0","asp.did.w2 <- lm(mg.asp ~ treat.dum*post.dum + factor(Region), # factor() inside formula"
"0","                 data=subset(mig_long, wave!=3 & !is.na(wt2)), # use mig.long directly"
"0","                 # weights=wt2 # Removed weights (consider re-adding based on final paper table)"
"0","                 )"
"0",""
"0","# Model 3: Difference-in-Means (Wave 3 only)"
"0","# Regresses mg.asp ~ treatment + Region FE, weighted by wt3."
"0","# Uses only Wave 3 data where wt3 is not missing (proxy for nonmissing3)."
"0","asp.w3 <- lm(mg.asp ~ treat.dum + factor(Region), # factor() inside formula"
"0","             data=subset(mig_long, wave==3 & !is.na(wt3)), # use mig.long directly"
"0","             weights=wt3)"
"0",""
"0","# Model 4: Difference-in-Differences (Baseline vs Wave 3, Weighted)"
"0","# Regresses mg.asp ~ treat.dum * post.dum + Region FE, weighted by wt3."
"0","# Filtering by !is.na(wt3) ensures sample consistency with Model 3. "
"0","asp.did.w3 <- lm(mg.asp ~ treat.dum*post.dum + factor(Region), # factor() inside formula"
"0","                 data=subset(mig_long, wave!=2 & !is.na(wt3)), # use mig.long directly"
"0","                 weights=wt3 # Re-added weights"
"0","                 )"
"0",""
"0","# Model 2 (Unweighted): Difference-in-Differences (Baseline vs Wave 2)"
"0","# Same as Model 2 but without weights."
"0","asp.did.w2_unw <- lm(mg.asp ~ treat.dum*post.dum + factor(Region), "
"0","                     data=subset(mig_long, wave!=3 & !is.na(wt2)) # Same subset, no weights"
"0","                     )"
"0",""
"0","# Model 4 (Unweighted): Difference-in-Differences (Baseline vs Wave 3)"
"0","# Same as Model 4 but without weights."
"0","asp.did.w3_unw <- lm(mg.asp ~ treat.dum*post.dum + factor(Region), "
"0","                     data=subset(mig_long, wave!=2 & !is.na(wt3)) # Same subset, no weights"
"0","                     )"
"0",""
"0","# --- INTENT: Prepare inputs for the first part of the table (Wave 2 models). ---"
"0","# --- EFFECT: Creates a named list `models_t2a` where names are the desired column headers (""W2 Mean"", ""W2 DiD Wgt"", ""W2 DiD Unw"") and values are the corresponding `lm` model objects (`asp.w2`, `asp.did.w2`, `asp.did.w2_unw`). Defines significance stars mapping. Defines a `tibble` `add_rows_t2a` containing custom rows (Fixed effects, IPW Weighted) to be added manually to the bottom of the `modelsummary` table. ---"
"0","# --- Create Table 2a: Wave 2 Comparisons --- "
"0","# List of Wave 2 models with simpler names"
"0","models_t2a <- list("
"0","  `W2 Mean` = asp.w2,"
"0","  `W2 DiD Wgt` = asp.did.w2,"
"0","  `W2 DiD Unw` = asp.did.w2_unw"
"0",")"
"0",""
"0","# Load modelsummary library (if not already loaded) (Moved to setup chunk)"
"0","# library(modelsummary)"
"0",""
"0","# Define significance stars "
"0","stars_map <- c(""†"" = 0.1, ""*"" = 0.05, ""**"" = 0.01, ""***"" = 0.001)"
"0",""
"0","# Define rows to add manually for Table 2a using simple names"
"0","add_rows_t2a <- tibble::tribble("
"0","  ~term,           ~`W2 Mean`, ~`W2 DiD Wgt`, ~`W2 DiD Unw`,"
"0","  ""Fixed effects"", ""Yes"", ""Yes"", ""Yes"","
"0","  ""IPW Weighted"",  ""Yes"", ""Yes"", ""No"""
"0",")"
"0",""
"0","# --- INTENT: Print a descriptive title for Table 2a directly into the output. ---"
"0","# --- EFFECT: Uses `cat()` to print the markdown-formatted title string to the console/output stream before the table itself is generated. `\n` adds newlines. ---"
"0","# Print a more descriptive title for Table 2a (Removed - using caption instead)"
"0","# cat(""\\n**Table 2a: Effect of Program on Migration Aspiration (Wave 2 Models)**\\n"")"
"0",""
"0","# --- INTENT: Generate and format Table 2a using `modelsummary`. ---"
"0","# --- EFFECT: Calls `modelsummary` with the list of Wave 2 models (`models_t2a`) and applies various formatting options:"
"0","#           - `output = ""kableExtra""`: Specifies LaTeX output compatible with `kableExtra`."
"0","#           - `fmt = 3`: Sets the default number of decimal places for numeric values."
"0","#           - `stars = stars_map`: Applies the custom significance stars."
"0","#           - `coef_omit = ""Region""`: Excludes coefficients for the regional fixed effects."
"0","#           - `coef_rename`: Provides user-friendly names for the remaining coefficients."
"0","#           - `gof_map`: Customizes the goodness-of-fit statistics reported (Observations, R-squared), including LaTeX formatting for R-squared."
"0","#           - `add_rows = add_rows_t2a`: Appends the custom rows defined earlier."
"0","#           - `notes`: Adds footnotes to the table."
"0","#           - `title = NULL`: Suppresses the default `modelsummary` title (handled by `cat()` above)."
"0","#           - `kable_styling_options`: Passes options directly to `kableExtra::kable_styling` for LaTeX formatting (e.g., `booktabs`, `escape = FALSE` to render LaTeX in notes/GOF). ---"
"0","# Generate Table 2a"
"0","modelsummary(models_t2a,"
"0","             output = ""kableExtra"", "
"0","             fmt = 3, "
"0","             stars = stars_map, "
"0","             coef_omit = ""Region"", "
"0","             coef_rename = c(""treat.dum"" = ""Treat assignment"", "
"0","                           ""post.dum"" = ""Post-treatment"", "
"0","                           ""treat.dum:post.dum"" = ""Treat x Post"","
"0","                           ""(Intercept)"" = ""Constant""), "
"0","             gof_map = list("
"0","               list(""raw"" = ""nobs"", ""clean"" = ""Observations"", ""fmt"" = 0),"
"0","               list(""raw"" = ""r.squared"", ""clean"" = ""R$^{2}$"", ""fmt"" = 3),"
"0","               list(""raw"" = ""adj.r.squared"", ""clean"" = ""Adj. R$^{2}$"", ""fmt"" = 3)"
"0","             ),"
"0","             add_rows = add_rows_t2a,"
"0","             notes = list(""Standard errors in parentheses."","
"0","                        ""† p<0.1; * p<0.05; ** p<0.01; *** p<0.001."","
"0","                        ""Model (1) weighted. Model (2a) weighted DiD (original script). Model (2b) unweighted DiD."","
"0","                        ""All models include regional fixed effects.""),"
"0","             title = ""Table 2a: Effect of Program on Migration Aspiration (Wave 2 Models)"", # Add title here"
"0","             kable_styling_options = list(latex_options = c(""striped"", ""hold_position""), "
"0","                                        booktabs = TRUE,"
"0","                                        escape = FALSE, # Ensure LaTeX in notes/GOF renders"
"0","                                        font_size = 10)"
"0","             )"
