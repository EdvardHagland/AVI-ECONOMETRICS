"0","# --- INTENT: Estimate Ordered Logit DiD models. ---"
"0","# --- EFFECT: Runs polr() models using mig_long with Hess=TRUE for standard errors. ---"
"0","# Note: We use the weighted specification here, matching the main paper's preferred approach."
"0",""
"0","# Define the formula for polr"
"0","ologit_formula <- mg.asp_ord ~ treat.dum * post.dum + factor(Region)"
"0",""
"0","# Model R2a: Ordered Logit DiD (Baseline vs Wave 2, Weighted)"
"0","data_w2_ologit <- subset(mig_long, wave != 3 & nonmissing2) # Use mig_long"
"0","# Ensure weights are positive and handle potential NAs"
"0","data_w2_ologit <- data_w2_ologit %>%"
"0","  filter(!is.na(wt2) & wt2 > 0 & complete.cases(.[, c(""mg.asp_ord"", ""treat.dum"", ""post.dum"", ""Region"")]))"
"0",""
"0","ologit.did.w2 <- NULL # Initialize as NULL"
"0","if(nrow(data_w2_ologit) > 0) {"
"0","  ologit.did.w2 <- tryCatch({"
"0","      polr(ologit_formula, data = data_w2_ologit, weights = wt2, Hess = TRUE)"
"0","    }, error = function(e) {"
"0","      message(""Error fitting Wave 2 Ordered Logit: "", e$message); return(NULL)"
"0","  })"
"0","} else {"
"0","  message(""Skipping Wave 2 Ordered Logit: No valid data after filtering."")"
"0","}"
"0",""
"0",""
"0","# Model R2b: Ordered Logit DiD (Baseline vs Wave 3, Weighted)"
"0","data_w3_ologit <- subset(mig_long, wave != 2 & nonmissing3) # Use mig_long"
"0","data_w3_ologit <- data_w3_ologit %>%"
"0","  filter(!is.na(wt3) & wt3 > 0 & complete.cases(.[, c(""mg.asp_ord"", ""treat.dum"", ""post.dum"", ""Region"")]))"
"0",""
"0","ologit.did.w3 <- NULL # Initialize as NULL"
"0","if(nrow(data_w3_ologit) > 0) {"
"0","  ologit.did.w3 <- tryCatch({"
"0","      polr(ologit_formula, data = data_w3_ologit, weights = wt3, Hess = TRUE)"
"0","    }, error = function(e) {"
"0","      message(""Error fitting Wave 3 Ordered Logit: "", e$message); return(NULL)"
"0","  })"
"0","} else {"
"0","  message(""Skipping Wave 3 Ordered Logit: No valid data after filtering."")"
"0","}"
"0",""
"0","message(""Ordered logit models estimated (if data allowed)."")"
