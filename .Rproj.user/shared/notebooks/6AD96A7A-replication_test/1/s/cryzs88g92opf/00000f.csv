"0","# --- INTENT: Model predictors of non-missing status for Wave 2 and Wave 3. ---"
"0","# --- EFFECT: Uses logistic regression (glm) on baseline data from mig_long. ---"
"0","message(""Running Attrition Analysis (Predictors of Non-Response)..."")"
"0",""
"0","# Define baseline variables available in mig_long format"
"0","# Note: Uses mg.pln instead of mg.pln_w1"
"0","baseline_vars_long <- c("
"0","  ""age"", ""educ"", ""male"", ""Region"", "
"0","  ""bs.exp.now"", ""bs.exp.past"", ""Score"", ""lost.job"", ""job_w1"", "
"0","  ""mg.pln"" # Use the wave-varying migration plan variable"
"0",")"
"0",""
"0","# Ensure mig_long exists and necessary variables are present"
"0","if (!exists(""mig_long"")) {"
"0","  stop(""Error in attrition-analysis: mig_long data frame not found."")"
"0","}"
"0","# Check against the correct list of variables for mig_long"
"0","required_vars_attrition <- c(""UniqueID"", ""wave"", ""nonmissing2"", ""nonmissing3"", ""treat.dum"", baseline_vars_long)"
"0","if (!all(required_vars_attrition %in% names(mig_long))) {"
"0","  missing_in_long <- setdiff(required_vars_attrition, names(mig_long))"
"0","  stop(paste(""Error in attrition-analysis: Required variables missing from mig_long:"", paste(missing_in_long, collapse="", "")))"
"0","}"
"0",""
"0","# Use baseline data (wave == 1) to predict future non-missingness"
"0","baseline_data_for_attrition <- mig_long %>%"
"0","  filter(wave == 1) %>%"
"0","  # Ensure predictors are suitable for regression (e.g., convert Region to factor if not already)"
"0","  mutate(Region = factor(Region)) # Ensure Region is factor"
"0",""
"0","# Define formula (excluding Region as it might cause separation issues, focus on individual chars)"
"0","# Note: Using baseline_vars defined for Table A1, excluding Region"
"0","predictors_for_attrition <- setdiff(baseline_vars_long, ""Region"")"
"0","attrition_formula_part <- paste(predictors_for_attrition, collapse = "" + "")"
"0","formula_w2 <- as.formula(paste(""nonmissing2 ~ treat.dum +"", attrition_formula_part))"
"0","formula_w3 <- as.formula(paste(""nonmissing3 ~ treat.dum +"", attrition_formula_part))"
"0",""
"0","# Fit Logistic Regression Models"
"0","attrition_model_w2 <- tryCatch({"
"0","  glm(formula_w2, data = baseline_data_for_attrition, family = binomial(link = ""logit""))"
"0","}, error = function(e) { message(""Error fitting Wave 2 attrition model: "", e$message); return(NULL) })"
"0",""
"0","attrition_model_w3 <- tryCatch({"
"0","  glm(formula_w3, data = baseline_data_for_attrition, family = binomial(link = ""logit""))"
"0","}, error = function(e) { message(""Error fitting Wave 3 attrition model: "", e$message); return(NULL) })"
"0",""
"0","# Display results using modelsummary"
"0","models_attrition <- list()"
"0","if (!is.null(attrition_model_w2)) models_attrition[[""Predictors of Wave 2 Response""]] <- attrition_model_w2"
"0","if (!is.null(attrition_model_w3)) models_attrition[[""Predictors of Wave 3 Response""]] <- attrition_model_w3"
"0",""
"0","if (length(models_attrition) > 0) {"
"0","  # Define nice labels for predictors (reuse from Table A1 where possible)"
"0","  coef_rename_attrition <- c("
"0","    ""(Intercept)"" = ""Constant"","
"0","    ""treat.dum"" = ""Treatment Assignment"","
"0","    ""age"" = ""Age"","
"0","    ""educ"" = ""Education Level"","
"0","    ""male"" = ""Male"","
"0","    # Region excluded from model"
"0","    ""bs.exp.now"" = ""Currently has business (Baseline)"","
"0","    ""bs.exp.past"" = ""Had business in past (Baseline)"","
"0","    ""Score"" = ""Eligibility Score"","
"0","    ""lost.job"" = ""COVID Job Loss Status (Baseline)"", # Need clarification if this is the right interpretation"
"0","    ""job_w1"" = ""Has Job (Baseline)"","
"0","    ""mg.pln"" = ""Migration Plans (Baseline, 1-3)"" # Renaming the correct variable"
"0","  )"
"0",""
"0","  # Display table (reporting odds ratios)"
"0","  modelsummary(models_attrition,"
"0","               output = ""kableExtra"","
"0","               fmt = 3,"
"0","               exponentiate = TRUE, # Display Odds Ratios"
"0","               stars = c('â€ ' = 0.1, '*' = 0.05, '**' = 0.01, '***' = 0.001),"
"0","               coef_rename = coef_rename_attrition,"
"0","               gof_map = list(list(""raw"" = ""nobs"", ""clean"" = ""Observations"", ""fmt"" = 0)),"
"0","               notes = list(""Table shows Odds Ratios (OR) from logistic regressions."","
"0","                          ""OR > 1 indicates higher odds of responding; OR < 1 indicates lower odds."","
"0","                          ""Baseline characteristics (Wave 1) predict response in Wave 2/3."","
"0","                          ""Standard errors in parentheses.""),"
"0","               title = ""Attrition Analysis: Predictors of Survey Response in Later Waves"","
"0","               escape = FALSE"
"0","               ) %>%"
"0","    kable_styling(latex_options = c(""striped"", ""hold_position""),"
"0","                  bootstrap_options = ""striped"","
"0","                  position = ""center"","
"0","                  font_size = 9,"
"0","                  full_width = FALSE) %>%"
"0","    column_spec(1, width = ""15em"") # Wider column for predictor names"
"0",""
"0","} else {"
"0","  message(""Skipping attrition table generation: No models successfully fitted."")"
"0","}"
