"0","# Load necessary packages"
"0","library(sandwich)  # For robust standard errors"
"0","library(lmtest)    # For coeftest"
"0","library(modelsummary) # For table presentation"
"0",""
"0","# Apply clustered standard errors to the main models"
"0","models_clustered <- list()"
"0",""
"0","# Wave 2 models with clustered SEs"
"0","w2_data <- subset(mig_long, wave!=3 & nonmissing2)"
"0","cluster_var_w2 <- w2_data$Region"
"0","asp.did.w2.clustered <- asp.did.w2"
"0","attr(asp.did.w2.clustered, ""vcov"") <- vcovCL(asp.did.w2, cluster = cluster_var_w2)"
"0","class(asp.did.w2.clustered) <- c(""lm_robust"", class(asp.did.w2))"
"0",""
"0","# Wave 3 models with clustered SEs"
"0","w3_data <- subset(mig_long, wave!=2 & nonmissing3)"
"0","cluster_var_w3 <- w3_data$Region"
"0","asp.did.w3.clustered <- asp.did.w3"
"0","attr(asp.did.w3.clustered, ""vcov"") <- vcovCL(asp.did.w3, cluster = cluster_var_w3)"
"0","class(asp.did.w3.clustered) <- c(""lm_robust"", class(asp.did.w3))"
"0",""
"0","# Add original and clustered models to list"
"0","models_clustered <- list("
"0","  ""W2 Original"" = asp.did.w2,"
"0","  ""W2 Clustered"" = asp.did.w2.clustered,"
"0","  ""W3 Original"" = asp.did.w3,"
"0","  ""W3 Clustered"" = asp.did.w3.clustered"
"0",")"
"0",""
"0","# Define custom tidy method for our lm_robust models"
"0","tidy.lm_robust <- function(x, ...) {"
"0","  coef_mat <- coeftest(x, vcov = attr(x, ""vcov""))"
"0","  data.frame("
"0","    term = rownames(coef_mat),"
"0","    estimate = coef_mat[, ""Estimate""],"
"0","    std.error = coef_mat[, ""Std. Error""],"
"0","    statistic = coef_mat[, ""t value""],"
"0","    p.value = coef_mat[, ""Pr(>|t|)""]"
"0","  )"
"0","}"
"0",""
"0","# Define custom glance method"
"0","glance.lm_robust <- function(x, ...) {"
"0","  # Extract the original model's glance info"
"0","  glance_info <- glance(x)"
"0","  # Return the same info"
"0","  return(glance_info)"
"0","}"
"0",""
"0","# Create table"
"0","modelsummary(models_clustered,"
"0","             output = ""kableExtra"", "
"0","             fmt = 3, "
"0","             stars = c(""â€ "" = 0.1, ""*"" = 0.05, ""**"" = 0.01, ""***"" = 0.001), "
"0","             coef_omit = ""Region"", "
"0","             coef_rename = c(""treat.dum"" = ""Treat assignment"", "
"0","                           ""post.dum"" = ""Post-treatment"", "
"0","                           ""treat.dum:post.dum"" = ""Treat x Post"","
"0","                           ""(Intercept)"" = ""Constant""), "
"0","             gof_map = list("
"0","               list(""raw"" = ""nobs"", ""clean"" = ""Observations"", ""fmt"" = 0),"
"0","               list(""raw"" = ""r.squared"", ""clean"" = ""R$^{2}$"", ""fmt"" = 3)"
"0","             ),"
"0","             notes = list("
"0","               ""Original models use default standard errors from lm()."","
"0","               ""Clustered models use standard errors adjusted for clustering at the region level."","
"0","               ""All models include regional fixed effects and are weighted."""
"0","             ),"
"0","             title = ""Table 2 Revisited: Effect of Program on Migration Aspiration with Clustered SEs"","
"0","             escape = FALSE"
"0","             ) %>%"
"0","  kable_styling(latex_options = c(""striped"", ""HOLD_position""), "
"0","                position = ""center"","
"0","                font_size = 9)"
"2","Error in if (x$clustered) { : argument is of length zero
"
