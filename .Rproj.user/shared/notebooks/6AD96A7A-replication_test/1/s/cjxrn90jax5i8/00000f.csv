"0","# --- INTENT: Replicate Table 1 using the original script's vtable::st() method for maximum fidelity. ---"
"0","# --- EFFECT: Selects necessary columns, defines labels, and calls vtable::st() to generate the summary table with weighted means and group tests directly. ---"
"0",""
"0","# --- Ensure necessary data frame `mig_business` with factor `treat.dum_fac` exists ---"
"0","# (This should be created just above this chunk or earlier)"
"0","if (!exists(""mig_business"")) {"
"0","  if (!exists(""mig_wide"")) {"
"0","    # Attempt to load mig_wide if it doesn't exist (adjust path if needed)"
"0","    data_path <- ""../data/"""
"0","    mig_wide <- read_csv(file.path(data_path, ""mig.wide.csv""), show_col_types = FALSE)"
"0","  }"
"0","  # Recreate mig_business if necessary"
"0","  mig_business <- mig_wide %>%"
"0","    mutate(treat.dum_fac = factor(treat.dum, levels = c(0, 1), labels = c(""Control"", ""Treatment"")))"
"0","}"
"0",""
"0","# --- Prepare the specific data subset for vtable ---"
"0","# Select only the required columns, mirroring the original script's `mig.business` subset"
"0","# No explicit row filtering or numeric conversion here - let vtable handle it."
"0","table1_vtable_data <- mig_business %>% "
"0","  dplyr::select(bus.location, bus.open, bus.purchases, bus.hire, bus.profit, bus.close, "
"0","                treat.dum_fac, wt3)"
"0",""
"0","# --- Define labels as in the original script ---"
"0","business.labs <- c("
"0","    ""bus.location"" = ""Selected location"", "
"0","    ""bus.open"" = ""Opened business"", "
"0","    ""bus.purchases"" = ""Made purchases"","
"0","    ""bus.hire"" = ""Hired employees"", "
"0","    ""bus.profit"" = ""Made profit"", "
"0","    ""bus.close"" = ""Closed business"""
"0",")"
"0",""
"0","# --- Generate the table using vtable::st --- "
"0","# Arguments adapted from original script for R Markdown output"
"0","vtable::st(table1_vtable_data, "
"0","           summ=list(c('mean(x)*100')), # Calculate mean and multiply by 100 for percentage"
"0","           summ.names=list(c('Percent (%)')), # Label the column"
"0","           group = ""treat.dum_fac"", "
"0","           # factor.numeric=T, # Let vtable handle type conversion if needed"
"0","           group.test=TRUE, # Use default tests (likely t-test/ANOVA F-test)"
"0","           # group.test=list(digits=2, star.cutoffs = c(0.1, 0.05, 0.01), star.markers = c(""\\textdagger"", ""*"", ""**"", ""***"")), # Keep original test format"
"0","           digits=1, # Show one decimal place for the percentage"
"0","           group.weights=""wt3"", "
"0","           labels=business.labs,"
"0","           title = ""Key Business Outcomes by Treatment Group (Wave 3) - vtable Replication"", # Add a title"
"0","           note = ""Percentages calculated using Wave 3 inverse probability weights (wt3). Significance levels (from F/t-test): *** p<0.001, ** p<0.01, * p<0.05, â€  p<0.1."","
"0","           note.align = 'l',"
"0","           fixed.digits = TRUE, # Ensure consistent decimal places"
"0","           # Removed: numformat, align, fit.page, out='latex'"
"0","           # Using simple mean*100 instead of numformat for better control"
"0","           )"
"2","Warning: fixed.digits is deprecated and will be removed in a future version in favor of a setting in "
"2","Warning: Factor variables ignore custom summ options. Cols 1 and 2 are count and percentage.
Beware combining factors with a custom summ unless factor.numeric = TRUE."
