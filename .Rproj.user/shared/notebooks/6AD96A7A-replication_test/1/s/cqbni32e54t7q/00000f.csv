"0","business_vars <- c(""bus.location"",""bus.open"",""bus.purchases"","
"0","                   ""bus.hire"",""bus.profit"",""bus.close"")"
"0",""
"0","results_df <- mig_wide %>% "
"0","  filter(!is.na(wt3)) %>% "
"0","  mutate(across(all_of(business_vars), as.numeric)) %>% "
"0","  reframe("
"0","    Variable   = business_vars,"
"0","    Control    = map_dbl(business_vars,"
"0","                   ~ weighted.mean(.data[[.x]][treat.dum==0], wt3[treat.dum==0], na.rm=TRUE)),"
"0","    Treatment  = map_dbl(business_vars,"
"0","                   ~ weighted.mean(.data[[.x]][treat.dum==1], wt3[treat.dum==1], na.rm=TRUE))"
"0","  ) %>% "
"0","  mutate("
"0","    `Difference (p.p.)` = (Treatment - Control)*100,"
"0","    Test = map_chr(Variable, ~{"
"0","             m <- lm(as.formula(paste(.x,""~ treat.dum"")), mig_wide, weights = wt3)"
"0","             f <- summary(m)$fstatistic[1]; p <- pf(f,summary(m)$fstatistic[2],"
"0","                                                   summary(m)$fstatistic[3], lower.tail=FALSE)"
"0","             stars <- case_when(p<.001~""***"",p<.01~""**"",p<.05~""*"",p<.1~""â€ "",TRUE~"""")"
"0","             sprintf(""F = %.2f%s"", f, stars)"
"0","           })"
"0","  )"
"2","Error: object '.x' not found
"
