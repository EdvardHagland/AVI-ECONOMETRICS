"0","# --- INTENT: Plot Wave 2 DiD effect stratified by baseline business experience. ---"
"0","# --- EFFECT: Runs separate DiD models or uses interaction model results for plotting. ---"
"0","message(""Generating HTE stratified plot..."")"
"0",""
"0","# Ensure the interaction model for bs.exp.now exists"
"0","if (!is.null(hte_bs_exp)) {"
"0","    library(effects) # Use effects package to easily get conditional effects"
"0","    library(ggplot2)"
"0",""
"0","    # Get conditional effects of treat.dum:post.dum at bs.exp.now=0 and bs.exp.now=1"
"0","    eff <- tryCatch({"
"0","        predictorEffect(""treat.dum:post.dum"", hte_bs_exp, focal.levels = c(0,1))"
"0","      }, error = function(e) {"
"0","          message(""Error getting effects for HTE plot: "", e$message); return(NULL)"
"0","    })"
"0",""
"0","    if (!is.null(eff)){"
"0","      eff_df <- as.data.frame(eff)"
"0","      "
"0","      # Clean up labels for plotting"
"0","      eff_df$bs.exp.now_label <- factor(eff_df$bs.exp.now, "
"0","                                         levels = c(0, 1), "
"0","                                         labels = c(""No Business at Baseline"", ""Had Business at Baseline""))"
"0",""
"0","      hte_strat_plot <- ggplot(eff_df, aes(x = bs.exp.now_label, y = fit, ymin = lower, ymax = upper)) +"
"0","        geom_point(size = 3) +"
"0","        geom_errorbar(width = 0.2) +"
"0","        geom_hline(yintercept = 0, linetype = ""dashed"", color = ""grey60"") +"
"0","        labs(title = ""Heterogeneity Check: Wave 2 DiD Effect by Baseline Business Status"","
"0","             subtitle = ""Estimated Treat x Post coefficient with 95% CIs"","
"0","             x = ""Baseline Business Experience"","
"0","             y = ""Estimated DiD Effect (Treat x Post)"") +"
"0","        theme_minimal(base_size = 11) +"
"0","        theme(plot.title = element_text(hjust = 0.5), "
"0","              plot.subtitle = element_text(hjust = 0.5))"
"0","        "
"0","      print(hte_strat_plot)"
"0","    } else {"
"0","      message(""Skipping HTE plot: Could not calculate effects from model."")"
"0","    }"
"0",""
"0","} else {"
"0","  message(""Skipping HTE plot: Interaction model 'hte_bs_exp' not found or failed."")"
"0","}"
"2","Error in library(effects) : there is no package called ‘effects’
"
